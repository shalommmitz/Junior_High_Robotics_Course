Shalom Mitz			25TH March 2017

OVERVIEW

The procedure below shows how to program the robot 'brain'. The brain is the 'WEMOS D1 Mini' part.
Normally, the D1 can be programmed while the display-module is attached.

## Prerequisits:

Make sure all needed software is installed on your PC, as detailed at the files "install_needed_software_linux.txt" and "install_needed_software_windows.txt"
      During the installation, enable the check-box "Add Python 3.7 to Path"



## Steps:

1) Connect the D1 to a PC, using a normal 'Android' USB cable

2) Find the serial port used by the robot-brain:
   ON LINUX:
   Using terminal, run 'ls /dev/ttyUSB'. This should show /dev/ttyUSB0
   If only /dev/ttyUSB2 exists, you should change 'burn' to reflect this
   If the 'ls' command above does not show anything, the D1 was not recognized.
   This must be resolved before continuing.

   ON WINDOWS:
      Open the "Device Manager":
         - Right-click on "Computer"
         - choose "Manage"
         - Expand "LPT and COM ports"
         - Notice the existing serial ports (called "COM" and a digit)
         - Plug-in the robot brain to the PC, using USB cable
         - Notice the name the new COM port. This is normally "COM4"

OPTIONAL: you can bring the latest firmware build from
     http://micropython.org/download#esp8266
     If you bring such a file, you need to modify the 2nd line of 'burn'

3) Program the D1 w/microPython: 
   ON LINUX: Simply run './burn'
       Note: 'burn' depends on the 'serial' Python module.
   ON WINDOWS:
       - Open comnmand prompt (Run: cmd)
       - `esptool.py erase_flash`
       - `esptool.py --baud 460800 write_flash --flash_size=detect 0 firmware.bin`

4) Sanity check: disconnect the D1 from the USB and plug back.
   When you re-connect the D1, one of the LEDs should blink twice.
   If the LED does not blink, or blink all the time, try to run 'burn' again
   Note: Detailed instructions of programming the D1 and troubleshooting can be found at:
   http://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html#deploying-the-firmware

5) Burn the additional files:
   Run './send_all_files'


Testing:

1) Connect to the D1: 
   The D1 looks like serial port at /dev/ttyUSB0 (rarly: /dev/ttyUSB1)
   You can connect to it using: putty, minicom, screen, or any other 'terminal emulation' sofware

   Once you are connected, hit "Enter" few times, and you should get the ">>>" REPL prompt.
   If you do not get the prompt, try unplugin/pluging from USB. If this fails, try 'burn' again.
   There is no point to continue w/o the REPL prompt.


 
Steps that are repeated each time the D1 is used:
1) Connect to the PC/laptop to the WiFi access-point created by the D1:
   Look at the available WiFi networks for a network called "MicroPython-xxxxxx" (the 'xxxxxx' part is different for each D1)
   Connect to this network.
   Note: This will probably disconnect you from the Internet. 

2) Connect to the D1 using WebREPL:
   If needed, download the webrepl files from  https://github.com/micropython/webrepl.
   Open the file "open webrepl.html in a browser. 
   You should get a prompt to choose password (first time) or login.
   After login, you should get the ">>>" prompt. You are also able to upload and download files.
   There are more details at: https://github.com/micropython/webrepl


3    Using WebREPL, import the 'robot' module. This will define 4 outputs:
    pwmRight, dirRight, pwmLeft, dirLeft
    Each of those can be set to high or low, for example:
    pwmRight.low() or pwmLeft.high() 
